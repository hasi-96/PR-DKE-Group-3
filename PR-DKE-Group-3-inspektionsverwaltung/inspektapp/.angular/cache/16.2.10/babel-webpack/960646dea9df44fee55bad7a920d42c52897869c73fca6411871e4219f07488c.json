{"ast":null,"code":"import _asyncToGenerator from \"/Users/jakob/Documents/GitHub/PR-DKE-Group-3/PR-DKE-Group-3-inspektionsverwaltung/investapp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { firstValueFrom } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../db/investitionDBService\";\nimport * as i2 from \"../service/investition.service\";\nimport * as i3 from \"@angular/forms\";\nexport class InvestitionenComponent {\n  constructor(dbService, apiService) {\n    this.dbService = dbService;\n    this.apiService = apiService;\n    this.investition = {\n      massnahmeID: 0,\n      jahr: new Date().getFullYear(),\n      kosten: 0,\n      anmerkung: ''\n    };\n    this.isSynchronizing = false;\n  }\n  ngOnInit() {\n    window.addEventListener('online', () => this.synchronizeData());\n  }\n  onSubmit(form) {\n    if (form.valid) {\n      this.dbService.addInvestition(this.investition).then(investitionsID => {\n        console.log('Investition in IndexedDB gespeichert mit ID:', investitionsID);\n        if (navigator.onLine && !this.isSynchronizing) {\n          this.synchronizeData();\n        }\n        form.resetForm();\n        this.resetInvestition();\n      });\n    }\n  }\n  resetInvestition() {\n    this.investition = {\n      massnahmeID: 0,\n      jahr: new Date().getFullYear(),\n      kosten: 0,\n      anmerkung: ''\n    };\n  }\n  synchronizeData() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if (_this.isSynchronizing || !navigator.onLine) {\n        return;\n      }\n      _this.isSynchronizing = true;\n      const investitionen = yield _this.dbService.getInvestitionen();\n      for (const investition of investitionen) {\n        yield firstValueFrom(_this.apiService.createInvestition(investition));\n        if (investition.investitionsID !== undefined) {\n          yield _this.dbService.deleteInvestition(investition.investitionsID);\n          console.log('Investition synchronisiert und aus IndexedDB gelöscht:', investition.investitionsID);\n        }\n      }\n      yield _this.dbService.clearAllData();\n      console.log('Alle Daten in der IndexedDB wurden gelöscht.');\n      _this.isSynchronizing = false;\n    })();\n  }\n  static #_ = this.ɵfac = function InvestitionenComponent_Factory(t) {\n    return new (t || InvestitionenComponent)(i0.ɵɵdirectiveInject(i1.InvestitionenDbService), i0.ɵɵdirectiveInject(i2.InvestitionService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: InvestitionenComponent,\n    selectors: [[\"app-investitionen\"]],\n    decls: 23,\n    vars: 4,\n    consts: [[1, \"container\"], [3, \"ngSubmit\"], [\"investitionForm\", \"ngForm\"], [1, \"form-group\"], [\"for\", \"massnahmeID\"], [\"type\", \"number\", \"id\", \"massnahmeID\", \"required\", \"\", \"name\", \"massnahmeID\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"jahr\"], [\"type\", \"number\", \"id\", \"jahr\", \"required\", \"\", \"name\", \"jahr\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"kosten\"], [\"type\", \"number\", \"id\", \"kosten\", \"required\", \"\", \"name\", \"kosten\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"anmerkung\"], [\"type\", \"text\", \"id\", \"anmerkung\", \"name\", \"anmerkung\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\"]],\n    template: function InvestitionenComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r1 = i0.ɵɵgetCurrentView();\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\");\n        i0.ɵɵtext(2, \"Investition erstellen\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"form\", 1, 2);\n        i0.ɵɵlistener(\"ngSubmit\", function InvestitionenComponent_Template_form_ngSubmit_3_listener() {\n          i0.ɵɵrestoreView(_r1);\n          const _r0 = i0.ɵɵreference(4);\n          return i0.ɵɵresetView(ctx.onSubmit(_r0));\n        });\n        i0.ɵɵelementStart(5, \"div\", 3)(6, \"label\", 4);\n        i0.ɵɵtext(7, \"Ma\\u00DFnahme ID: \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"input\", 5);\n        i0.ɵɵlistener(\"ngModelChange\", function InvestitionenComponent_Template_input_ngModelChange_8_listener($event) {\n          return ctx.investition.massnahmeID = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(9, \"div\", 3)(10, \"label\", 6);\n        i0.ɵɵtext(11, \"Jahr: \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"input\", 7);\n        i0.ɵɵlistener(\"ngModelChange\", function InvestitionenComponent_Template_input_ngModelChange_12_listener($event) {\n          return ctx.investition.jahr = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(13, \"div\", 3)(14, \"label\", 8);\n        i0.ɵɵtext(15, \"Kosten: \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"input\", 9);\n        i0.ɵɵlistener(\"ngModelChange\", function InvestitionenComponent_Template_input_ngModelChange_16_listener($event) {\n          return ctx.investition.kosten = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(17, \"div\", 3)(18, \"label\", 10);\n        i0.ɵɵtext(19, \"Anmerkung: \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"input\", 11);\n        i0.ɵɵlistener(\"ngModelChange\", function InvestitionenComponent_Template_input_ngModelChange_20_listener($event) {\n          return ctx.investition.anmerkung = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(21, \"button\", 12);\n        i0.ɵɵtext(22, \"Speichern\");\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngModel\", ctx.investition.massnahmeID);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngModel\", ctx.investition.jahr);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngModel\", ctx.investition.kosten);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngModel\", ctx.investition.anmerkung);\n      }\n    },\n    dependencies: [i3.ɵNgNoValidate, i3.DefaultValueAccessor, i3.NumberValueAccessor, i3.NgControlStatus, i3.NgControlStatusGroup, i3.RequiredValidator, i3.NgModel, i3.NgForm],\n    styles: [\"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n  });\n}","map":{"version":3,"names":["firstValueFrom","InvestitionenComponent","constructor","dbService","apiService","investition","massnahmeID","jahr","Date","getFullYear","kosten","anmerkung","isSynchronizing","ngOnInit","window","addEventListener","synchronizeData","onSubmit","form","valid","addInvestition","then","investitionsID","console","log","navigator","onLine","resetForm","resetInvestition","_this","_asyncToGenerator","investitionen","getInvestitionen","createInvestition","undefined","deleteInvestition","clearAllData","_","i0","ɵɵdirectiveInject","i1","InvestitionenDbService","i2","InvestitionService","_2","selectors","decls","vars","consts","template","InvestitionenComponent_Template","rf","ctx","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵlistener","InvestitionenComponent_Template_form_ngSubmit_3_listener","ɵɵrestoreView","_r1","_r0","ɵɵreference","ɵɵresetView","InvestitionenComponent_Template_input_ngModelChange_8_listener","$event","InvestitionenComponent_Template_input_ngModelChange_12_listener","InvestitionenComponent_Template_input_ngModelChange_16_listener","InvestitionenComponent_Template_input_ngModelChange_20_listener","ɵɵadvance","ɵɵproperty"],"sources":["/Users/jakob/Documents/GitHub/PR-DKE-Group-3/PR-DKE-Group-3-inspektionsverwaltung/investapp/src/app/investitionen/investitionen.component.ts","/Users/jakob/Documents/GitHub/PR-DKE-Group-3/PR-DKE-Group-3-inspektionsverwaltung/investapp/src/app/investitionen/investitionen.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { NgForm } from '@angular/forms';\nimport {InvestitionenDbService} from \"../db/investitionDBService\";\nimport {InvestitionService} from \"../service/investition.service\";\nimport {Investition} from \"../investition\";\nimport { firstValueFrom } from 'rxjs';\n\n\n@Component({\n  selector: 'app-investitionen',\n  templateUrl: './investitionen.component.html',\n  styleUrls: ['./investitionen.component.css']\n})\nexport class InvestitionenComponent implements OnInit {\n  investition: Investition = {\n    massnahmeID: 0,\n    jahr: new Date().getFullYear(),\n    kosten: 0,\n    anmerkung: ''\n  };\n    private isSynchronizing = false;\n  constructor(\n    private dbService: InvestitionenDbService,\n    private apiService: InvestitionService\n  ) {}\n\n  ngOnInit() {\n    window.addEventListener('online', () => this.synchronizeData());\n  }\n\n  onSubmit(form: NgForm) {\n    if (form.valid) {\n      this.dbService.addInvestition(this.investition).then(investitionsID => {\n        console.log('Investition in IndexedDB gespeichert mit ID:', investitionsID);\n          if (navigator.onLine && !this.isSynchronizing){\n          this.synchronizeData();\n        }\n        form.resetForm();\n        this.resetInvestition();\n      });\n    }\n  }\n\n  private resetInvestition() {\n    this.investition = {\n      massnahmeID: 0,\n      jahr: new Date().getFullYear(),\n      kosten: 0,\n      anmerkung: ''\n    };\n  }\n\n    private async synchronizeData(): Promise<void> {\n        if (this.isSynchronizing || !navigator.onLine) {\n            return;\n        }\n        this.isSynchronizing = true;\n\n        const investitionen = await this.dbService.getInvestitionen();\n        for (const investition of investitionen) {\n            await firstValueFrom(this.apiService.createInvestition(investition));\n            if (investition.investitionsID !== undefined) {\n                await this.dbService.deleteInvestition(investition.investitionsID);\n                console.log('Investition synchronisiert und aus IndexedDB gelöscht:', investition.investitionsID);\n            }\n        }\n\n        await this.dbService.clearAllData();\n        console.log('Alle Daten in der IndexedDB wurden gelöscht.');\n\n        this.isSynchronizing = false;\n    }\n\n\n}\n","<div class=\"container\">\n  <h2>Investition erstellen</h2>\n  <form #investitionForm=\"ngForm\" (ngSubmit)=\"onSubmit(investitionForm)\">\n    <div class=\"form-group\">\n      <label for=\"massnahmeID\">Maßnahme ID: </label>\n      <input type=\"number\" class=\"form-control\" id=\"massnahmeID\" required [(ngModel)]=\"investition.massnahmeID\" name=\"massnahmeID\">\n    </div>\n    <div class=\"form-group\">\n      <label for=\"jahr\">Jahr: </label>\n      <input type=\"number\" class=\"form-control\" id=\"jahr\" required [(ngModel)]=\"investition.jahr\" name=\"jahr\">\n    </div>\n    <div class=\"form-group\">\n      <label for=\"kosten\">Kosten: </label>\n      <input type=\"number\" class=\"form-control\" id=\"kosten\" required [(ngModel)]=\"investition.kosten\" name=\"kosten\">\n    </div>\n    <div class=\"form-group\">\n      <label for=\"anmerkung\">Anmerkung: </label>\n      <input type=\"text\" class=\"form-control\" id=\"anmerkung\" [(ngModel)]=\"investition.anmerkung\" name=\"anmerkung\">\n    </div>\n    <button type=\"submit\" class=\"btn btn-primary\">Speichern</button>\n  </form>\n</div>\n\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}